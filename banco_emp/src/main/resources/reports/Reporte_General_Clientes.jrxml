<!-- Created with Jaspersoft Studio version 7.0.3.final using JasperReports Library version 7.0.3-41034ca841d452f3305ba55b9042260aaa1ab5dd  -->
<jasperReport name="reporte_clientes_general" language="java" pageWidth="842" pageHeight="595" orientation="Landscape" columnWidth="802" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="1a2b3c4d-5e6f-7a8b-9c0d-1e2f3a4b5c6d">
    <property name="com.jaspersoft.studio.data.defaultdataadapter" value="PostgresBanco"/>
    <property name="com.jaspersoft.studio.unit." value="pixel"/>
    <property name="com.jaspersoft.studio.unit.pageHeight" value="pixel"/>
    <property name="com.jaspersoft.studio.unit.pageWidth" value="pixel"/>
    <parameter name="NOMBRE_BANCO" class="java.lang.String">
        <defaultValueExpression><![CDATA["FinanGlobal S.A.C"]]></defaultValueExpression>
    </parameter>
    <query language="sql"><![CDATA[SELECT
    u.id_usuario,
    CONCAT(u.nombre, ' ', u.apellidos) AS nombre_completo,
    u.nombre,
    u.apellidos,
    u.dni_ruc,
    u.sexo,
    u.correo,
    u.telefono,
    u.direccion,
    u.nombre_usuario,
    r.rol AS tipo_usuario,
    r.descripcion AS rol_descripcion,
    COUNT(DISTINCT cb.id) AS total_cuentas,
    COALESCE(SUM(cb.saldo), 0) AS saldo_total,
    COUNT(DISTINCT t.id) AS total_tarjetas,
    (SELECT COUNT(*) FROM transferencia WHERE id_usuario_emisor = u.id_usuario OR id_usuario_receptor = u.id_usuario) AS total_transferencias,
    (SELECT COUNT(*) FROM lista_empenos WHERE id_usuario = u.id_usuario) AS total_empenos
FROM t_usuario u
JOIN rol_usuario r ON u.rol_usuario = r.id
LEFT JOIN cuenta_bancaria cb ON cb.id_usuario = u.id_usuario
LEFT JOIN lista_tarjetas lt ON lt.id_usuario = u.id_usuario
LEFT JOIN tarjetas t ON t.id = lt.id_tarjeta
WHERE r.rol = 'Cliente'
GROUP BY u.id_usuario, u.nombre, u.apellidos, u.dni_ruc, u.sexo, u.correo, u.telefono, u.direccion, u.nombre_usuario, r.rol, r.descripcion
ORDER BY saldo_total DESC]]></query>
    <field name="id_usuario" class="java.lang.Long"/>
    <field name="nombre_completo" class="java.lang.String"/>
    <field name="nombre" class="java.lang.String"/>
    <field name="apellidos" class="java.lang.String"/>
    <field name="dni_ruc" class="java.lang.String"/>
    <field name="sexo" class="java.lang.String"/>
    <field name="correo" class="java.lang.String"/>
    <field name="telefono" class="java.lang.String"/>
    <field name="direccion" class="java.lang.String"/>
    <field name="nombre_usuario" class="java.lang.String"/>
    <field name="tipo_usuario" class="java.lang.String"/>
    <field name="rol_descripcion" class="java.lang.String"/>
    <field name="total_cuentas" class="java.lang.Long"/>
    <field name="saldo_total" class="java.math.BigDecimal"/>
    <field name="total_tarjetas" class="java.lang.Long"/>
    <field name="total_transferencias" class="java.lang.Long"/>
    <field name="total_empenos" class="java.lang.Long"/>
    <variable name="total_clientes" calculation="Count" class="java.lang.Integer">
        <expression><![CDATA[$F{id_usuario}]]></expression>
        <initialValueExpression><![CDATA[0]]></initialValueExpression>
    </variable>
    <variable name="suma_saldos" calculation="Sum" class="java.math.BigDecimal">
        <expression><![CDATA[$F{saldo_total}]]></expression>
        <initialValueExpression><![CDATA[new BigDecimal(0)]]></initialValueExpression>
    </variable>
    <variable name="suma_cuentas" calculation="Sum" class="java.lang.Long">
        <expression><![CDATA[$F{total_cuentas}]]></expression>
        <initialValueExpression><![CDATA[0L]]></initialValueExpression>
    </variable>
    <variable name="suma_tarjetas" calculation="Sum" class="java.lang.Long">
        <expression><![CDATA[$F{total_tarjetas}]]></expression>
        <initialValueExpression><![CDATA[0L]]></initialValueExpression>
    </variable>
    <variable name="promedio_saldo" class="java.math.BigDecimal">
        <expression><![CDATA[$V{total_clientes} > 0 ? $V{suma_saldos}.divide(new BigDecimal($V{total_clientes}), 2, java.math.RoundingMode.HALF_UP) : new BigDecimal(0)]]></expression>
    </variable>
    <title height="100" splitType="Stretch">
        <element kind="rectangle" uuid="2b3c4d5e-6f7a-8b9c-0d1e-2f3a4b5c6d7e" x="0" y="0" width="802" height="100" backcolor="#1A3A5C">
            <pen lineWidth="0.0"/>
        </element>
        <element kind="rectangle" uuid="3c4d5e6f-7a8b-9c0d-1e2f-3a4b5c6d7e8f" x="0" y="0" width="802" height="5" backcolor="#06B6D4">
            <pen lineWidth="0.0"/>
        </element>
        <element kind="rectangle" uuid="4d5e6f7a-8b9c-0d1e-2f3a-4b5c6d7e8f9a" x="20" y="20" width="60" height="60" backcolor="#06B6D4">
            <pen lineWidth="2.0" lineColor="#FFFFFF"/>
        </element>
        <element kind="staticText" uuid="5e6f7a8b-9c0d-1e2f-3a4b-5c6d7e8f9a0b" x="25" y="35" width="50" height="30" forecolor="#FFFFFF" fontSize="20.0" bold="true" hTextAlign="Center" vTextAlign="Middle">
            <text><![CDATA[ðŸ‘¥]]></text>
        </element>
        <element kind="textField" uuid="6f7a8b9c-0d1e-2f3a-4b5c-6d7e8f9a0b1c" x="90" y="20" width="700" height="25" forecolor="#06B6D4" fontSize="16.0" bold="true" vTextAlign="Middle">
            <expression><![CDATA[$P{NOMBRE_BANCO}]]></expression>
        </element>
        <element kind="staticText" uuid="7a8b9c0d-1e2f-3a4b-5c6d-7e8f9a0b1c2d" x="90" y="45" width="700" height="30" forecolor="#FFFFFF" fontSize="20.0" bold="true" hTextAlign="Left" vTextAlign="Middle">
            <text><![CDATA[REPORTE GENERAL DE CLIENTES]]></text>
        </element>
        <element kind="staticText" uuid="8b9c0d1e-2f3a-4b5c-6d7e-8f9a0b1c2d3e" x="90" y="75" width="700" height="20" forecolor="#E0E0E0" fontSize="11.0" italic="true" hTextAlign="Left" vTextAlign="Middle">
            <text><![CDATA[Listado completo de clientes con resumen de actividad financiera]]></text>
        </element>
    </title>
    <pageHeader height="70" splitType="Stretch">
        <element kind="rectangle" uuid="9c0d1e2f-3a4b-5c6d-7e8f-9a0b1c2d3e4f" x="0" y="0" width="802" height="70" backcolor="#F8F9FA">
            <pen lineWidth="0.5" lineColor="#CCCCCC"/>
        </element>
        <element kind="staticText" uuid="0d1e2f3a-4b5c-6d7e-8f9a-0b1c2d3e4f5a" x="10" y="10" width="100" height="15" forecolor="#666666" fontSize="8.0" bold="true" vTextAlign="Middle">
            <text><![CDATA[Fecha de emisiÃ³n:]]></text>
        </element>
        <element kind="textField" uuid="1e2f3a4b-5c6d-7e8f-9a0b-1c2d3e4f5a6b" x="10" y="25" width="200" height="18" forecolor="#1A3A5C" fontSize="10.0" pattern="dd/MM/yyyy HH:mm:ss" bold="true" vTextAlign="Middle">
            <expression><![CDATA[new java.util.Date()]]></expression>
        </element>
        <element kind="staticText" uuid="2f3a4b5c-6d7e-8f9a-0b1c-2d3e4f5a6b7c" x="10" y="48" width="150" height="15" forecolor="#666666" fontSize="8.0" bold="true" vTextAlign="Middle">
            <text><![CDATA[Reporte generado por el sistema]]></text>
        </element>
        <element kind="textField" uuid="3a4b5c6d-7e8f-9a0b-1c2d-3e4f5a6b7c8d" x="650" y="15" width="100" height="20" forecolor="#1A3A5C" fontSize="11.0" bold="true" hTextAlign="Right" vTextAlign="Middle">
            <expression><![CDATA["PÃ¡gina " + $V{PAGE_NUMBER}]]></expression>
        </element>
        <element kind="textField" uuid="4b5c6d7e-8f9a-0b1c-2d3e-4f5a6b7c8d9e" x="750" y="15" width="50" height="20" forecolor="#1A3A5C" fontSize="11.0" evaluationTime="Report" bold="true" vTextAlign="Middle">
            <expression><![CDATA[" / " + $V{PAGE_NUMBER}]]></expression>
        </element>
        <element kind="line" uuid="5c6d7e8f-9a0b-1c2d-3e4f-5a6b7c8d9e0f" x="0" y="68" width="802" height="1" forecolor="#1A3A5C">
            <pen lineWidth="2.0"/>
        </element>
    </pageHeader>
    <columnHeader height="40" splitType="Stretch">
        <element kind="rectangle" uuid="6d7e8f9a-0b1c-2d3e-4f5a-6b7c8d9e0f1a" x="0" y="0" width="802" height="40" backcolor="#1A3A5C">
            <pen lineWidth="0.0"/>
        </element>
        <element kind="staticText" uuid="7e8f9a0b-1c2d-3e4f-5a6b-7c8d9e0f1a2b" x="10" y="10" width="30" height="20" forecolor="#FFFFFF" fontSize="8.0" bold="true" hTextAlign="Center" vTextAlign="Middle">
            <text><![CDATA[ID]]></text>
        </element>
        <element kind="staticText" uuid="8f9a0b1c-2d3e-4f5a-6b7c-8d9e0f1a2b3c" x="50" y="10" width="140" height="20" forecolor="#FFFFFF" fontSize="8.0" bold="true" vTextAlign="Middle">
            <text><![CDATA[Cliente / Contacto]]></text>
        </element>
        <element kind="staticText" uuid="9a0b1c2d-3e4f-5a6b-7c8d-9e0f1a2b3c4d" x="200" y="10" width="110" height="20" forecolor="#FFFFFF" fontSize="8.0" bold="true" vTextAlign="Middle">
            <text><![CDATA[Documento / Usuario]]></text>
        </element>
        <element kind="staticText" uuid="0b1c2d3e-4f5a-6b7c-8d9e-0f1a2b3c4d5e" x="320" y="10" width="100" height="20" forecolor="#FFFFFF" fontSize="8.0" bold="true" hTextAlign="Right" vTextAlign="Middle">
            <text><![CDATA[Saldo Total]]></text>
        </element>
        <element kind="staticText" uuid="1c2d3e4f-5a6b-7c8d-9e0f-1a2b3c4d5e6f" x="430" y="10" width="50" height="20" forecolor="#FFFFFF" fontSize="8.0" bold="true" hTextAlign="Center" vTextAlign="Middle">
            <text><![CDATA[Ctas.]]></text>
        </element>
        <element kind="staticText" uuid="2d3e4f5a-6b7c-8d9e-0f1a-2b3c4d5e6f7a" x="490" y="10" width="50" height="20" forecolor="#FFFFFF" fontSize="8.0" bold="true" hTextAlign="Center" vTextAlign="Middle">
            <text><![CDATA[Tarj.]]></text>
        </element>
        <element kind="staticText" uuid="3e4f5a6b-7c8d-9e0f-1a2b-3c4d5e6f7a8b" x="550" y="10" width="60" height="20" forecolor="#FFFFFF" fontSize="8.0" bold="true" hTextAlign="Center" vTextAlign="Middle">
            <text><![CDATA[Transf.]]></text>
        </element>
        <element kind="staticText" uuid="4f5a6b7c-8d9e-0f1a-2b3c-4d5e6f7a8b9c" x="620" y="10" width="60" height="20" forecolor="#FFFFFF" fontSize="8.0" bold="true" hTextAlign="Center" vTextAlign="Middle">
            <text><![CDATA[Emp.]]></text>
        </element>
        <element kind="staticText" uuid="5a6b7c8d-9e0f-1a2b-3c4d-5e6f7a8b9c0d" x="690" y="10" width="100" height="20" forecolor="#FFFFFF" fontSize="8.0" bold="true" hTextAlign="Center" vTextAlign="Middle">
            <text><![CDATA[DirecciÃ³n]]></text>
        </element>
    </columnHeader>
    <detail>
        <band height="65" splitType="Stretch">
            <element kind="rectangle" uuid="6b7c8d9e-0f1a-2b3c-4d5e-6f7a8b9c0d1e" x="0" y="0" width="802" height="65" backcolor="#FAFAFA">
                <printWhenExpression><![CDATA[$V{REPORT_COUNT} % 2 == 0]]></printWhenExpression>
                <pen lineWidth="0.0"/>
            </element>
            <element kind="textField" uuid="7c8d9e0f-1a2b-3c4d-5e6f-7a8b9c0d1e2f" x="10" y="22" width="30" height="15" fontSize="8.0" bold="true" hTextAlign="Center" vTextAlign="Middle">
                <expression><![CDATA[$F{id_usuario}]]></expression>
            </element>
            <element kind="textField" uuid="8d9e0f1a-2b3c-4d5e-6f7a-8b9c0d1e2f3a" x="50" y="10" width="140" height="14" fontSize="9.0" bold="true" vTextAlign="Middle">
                <expression><![CDATA[$F{nombre_completo}]]></expression>
            </element>
            <element kind="textField" uuid="9e0f1a2b-3c4d-5e6f-7a8b-9c0d1e2f3a4b" x="50" y="24" width="140" height="11" forecolor="#666666" fontSize="7.0" vTextAlign="Middle">
                <expression><![CDATA["ðŸ“ž " + $F{telefono}]]></expression>
            </element>
            <element kind="textField" uuid="0f1a2b3c-4d5e-6f7a-8b9c-0d1e2f3a4b5c" x="50" y="35" width="140" height="11" forecolor="#999999" fontSize="6.5" vTextAlign="Middle">
                <expression><![CDATA["âœ‰ " + $F{correo}]]></expression>
            </element>
            <element kind="textField" uuid="1a2b3c4d-5e6f-7a8b-9c0d-1e2f3a4b5c6d" x="50" y="46" width="140" height="10" forecolor="#999999" fontSize="6.0" vTextAlign="Middle">
                <expression><![CDATA["Sexo: " + $F{sexo}]]></expression>
            </element>
            <element kind="textField" uuid="2b3c4d5e-6f7a-8b9c-0d1e-2f3a4b5c6d7e" x="200" y="15" width="110" height="13" fontSize="8.0" bold="true" vTextAlign="Middle">
                <expression><![CDATA["DNI: " + $F{dni_ruc}]]></expression>
            </element>
            <element kind="textField" uuid="3c4d5e6f-7a8b-9c0d-1e2f-3a4b5c6d7e8f" x="200" y="28" width="110" height="12" forecolor="#666666" fontSize="7.0" vTextAlign="Middle">
                <expression><![CDATA["ðŸ‘¤ " + $F{nombre_usuario}]]></expression>
            </element>
            <element kind="textField" uuid="4d5e6f7a-8b9c-0d1e-2f3a-4b5c6d7e8f9a" x="320" y="22" width="100" height="20" forecolor="#06B6D4" fontSize="11.0" pattern="S/ #,##0.00" bold="true" hTextAlign="Right" vTextAlign="Middle">
                <expression><![CDATA[$F{saldo_total}]]></expression>
            </element>
            <element kind="textField" uuid="5e6f7a8b-9c0d-1e2f-3a4b-5c6d7e8f9a0b" x="430" y="22" width="50" height="20" fontSize="9.0" bold="true" hTextAlign="Center" vTextAlign="Middle">
                <expression><![CDATA[$F{total_cuentas}]]></expression>
            </element>
            <element kind="textField" uuid="6f7a8b9c-0d1e-2f3a-4b5c-6d7e8f9a0b1c" x="490" y="22" width="50" height="20" fontSize="9.0" bold="true" hTextAlign="Center" vTextAlign="Middle">
                <expression><![CDATA[$F{total_tarjetas}]]></expression>
            </element>
            <element kind="textField" uuid="7a8b9c0d-1e2f-3a4b-5c6d-7e8f9a0b1c2d" x="550" y="22" width="60" height="20" fontSize="9.0" bold="true" hTextAlign="Center" vTextAlign="Middle">
                <expression><![CDATA[$F{total_transferencias}]]></expression>
            </element>
            <element kind="textField" uuid="8b9c0d1e-2f3a-4b5c-6d7e-8f9a0b1c2d3e" x="620" y="22" width="60" height="20" fontSize="9.0" bold="true" hTextAlign="Center" vTextAlign="Middle">
                <expression><![CDATA[$F{total_empenos}]]></expression>
            </element>
            <element kind="textField" uuid="9c0d1e2f-3a4b-5c6d-7e8f-9a0b1c2d3e4f" x="690" y="18" width="100" height="28" forecolor="#666666" fontSize="7.0" hTextAlign="Center" vTextAlign="Middle">
                <expression><![CDATA[$F{direccion}]]></expression>
            </element>
            <element kind="line" uuid="0d1e2f3a-4b5c-6d7e-8f9a-0b1c2d3e4f5a" x="10" y="63" width="782" height="1" forecolor="#E0E0E0"/>
        </band>
    </detail>
    <columnFooter splitType="Stretch"/>
    <pageFooter height="40" splitType="Stretch">
        <element kind="line" uuid="1e2f3a4b-5c6d-7e8f-9a0b-1c2d3e4f5a6b" x="0" y="5" width="802" height="1" forecolor="#1A3A5C">
            <pen lineWidth="1.5"/>
        </element>
        <element kind="staticText" uuid="2f3a4b5c-6d7e-8f9a-0b1c-2d3e4f5a6b7c" x="10" y="12" width="400" height="15" forecolor="#666666" fontSize="8.0" vTextAlign="Middle">
            <text><![CDATA[Sistema Bancario - Reporte generado automÃ¡ticamente]]></text>
        </element>
        <element kind="textField" uuid="3a4b5c6d-7e8f-9a0b-1c2d-3e4f5a6b7c8d" x="10" y="25" width="400" height="12" forecolor="#999999" fontSize="7.0" pattern="'Generado el' dd/MM/yyyy 'a las' HH:mm:ss" italic="true" vTextAlign="Middle">
            <expression><![CDATA[new java.util.Date()]]></expression>
        </element>
        <element kind="textField" uuid="4b5c6d7e-8f9a-0b1c-2d3e-4f5a6b7c8d9e" x="680" y="12" width="120" height="20" forecolor="#1A3A5C" fontSize="9.0" bold="true" hTextAlign="Right" vTextAlign="Middle">
            <expression><![CDATA["PÃ¡gina " + $V{PAGE_NUMBER}]]></expression>
        </element>
        <element kind="staticText" uuid="5c6d7e8f-9a0b-1c2d-3e4f-5a6b7c8d9e0f" x="420" y="25" width="380" height="12" forecolor="#CC0000" fontSize="7.0" bold="true" italic="true" hTextAlign="Right" vTextAlign="Middle">
            <text><![CDATA[DOCUMENTO CONFIDENCIAL - USO INTERNO]]></text>
        </element>
    </pageFooter>
    <summary height="170" splitType="Stretch">
        <element kind="line" uuid="6d7e8f9a-0b1c-2d3e-4f5a-6b7c8d9e0f1a" x="0" y="10" width="802" height="1" forecolor="#1A3A5C">
            <pen lineWidth="2.0"/>
        </element>
        <element kind="rectangle" uuid="7e8f9a0b-1c2d-3e4f-5a6b-7c8d9e0f1a2b" x="0" y="20" width="802" height="140" backcolor="#ECFEFF">
            <pen lineWidth="1.5" lineColor="#1A3A5C"/>
        </element>
        <element kind="staticText" uuid="8f9a0b1c-2d3e-4f5a-6b7c-8d9e0f1a2b3c" x="20" y="30" width="300" height="25" forecolor="#1A3A5C" fontSize="14.0" bold="true" vTextAlign="Middle">
            <text><![CDATA[ðŸ“Š RESUMEN GENERAL DE CLIENTES]]></text>
        </element>
        <element kind="line" uuid="9a0b1c2d-3e4f-5a6b-7c8d-9e0f1a2b3c4d" x="20" y="58" width="300" height="2" forecolor="#06B6D4">
            <pen lineWidth="2.0"/>
        </element>
        <element kind="staticText" uuid="0b1c2d3e-4f5a-6b7c-8d9e-0f1a2b3c4d5e" x="30" y="70" width="150" height="18" forecolor="#1A3A5C" fontSize="11.0" bold="true" vTextAlign="Middle">
            <text><![CDATA[ðŸ‘¥ Total de Clientes:]]></text>
        </element>
        <element kind="textField" uuid="1c2d3e4f-5a6b-7c8d-9e0f-1a2b3c4d5e6f" x="180" y="70" width="80" height="18" forecolor="#1A3A5C" fontSize="12.0" bold="true" hTextAlign="Right" vTextAlign="Middle">
            <expression><![CDATA[$V{total_clientes}]]></expression>
        </element>
        <element kind="staticText" uuid="2d3e4f5a-6b7c-8d9e-0f1a-2b3c4d5e6f7a" x="30" y="93" width="150" height="18" forecolor="#1A3A5C" fontSize="11.0" bold="true" vTextAlign="Middle">
            <text><![CDATA[ðŸ’° Saldo Total Clientes:]]></text>
        </element>
        <element kind="textField" uuid="3e4f5a6b-7c8d-9e0f-1a2b-3c4d5e6f7a8b" x="180" y="93" width="140" height="18" forecolor="#06B6D4" fontSize="13.0" pattern="S/ #,##0.00" bold="true" hTextAlign="Right" vTextAlign="Middle">
            <expression><![CDATA[$V{suma_saldos}]]></expression>
        </element>
        <element kind="staticText" uuid="c3f4a5b6-d7e8-4c63-9f8a-2b3c4d5e6f7a" x="350" y="70" width="180" height="20" forecolor="#1A3A5C" fontSize="11.0" bold="true" vTextAlign="Middle">
            <text><![CDATA[ðŸ¦ Total de Cuentas Bancarias:]]></text>
        </element>
        <element kind="textField" uuid="51858090-32d1-4d3d-95c2-ebef102f4199" x="530" y="70" width="100" height="20" forecolor="#1A3A5C" fontSize="12.0" bold="true" hTextAlign="Right" vTextAlign="Middle">
            <expression><![CDATA[$V{suma_cuentas}]]></expression>
        </element>
        <element kind="staticText" uuid="cf347344-25d5-42c1-bd47-face67ad370a" x="350" y="95" width="180" height="20" forecolor="#1A3A5C" fontSize="11.0" bold="true" vTextAlign="Middle">
            <text><![CDATA[ðŸ’³ Total de Tarjetas:]]></text>
        </element>
        <element kind="textField" uuid="73e25bce-a6fb-4993-ae76-74cc9ff065ce" x="530" y="95" width="100" height="20" forecolor="#1A3A5C" fontSize="12.0" bold="true" hTextAlign="Right" vTextAlign="Middle">
            <expression><![CDATA[$V{suma_tarjetas}]]></expression>
        </element>
        <element kind="staticText" uuid="4f5a6b7c-8d9e-0f1a-2b3c-4d5e6f7a8b9c" x="30" y="116" width="150" height="18" forecolor="#1A3A5C" fontSize="11.0" bold="true" vTextAlign="Middle">
            <text><![CDATA[ðŸ“ˆ Saldo Promedio:]]></text>
        </element>
        <element kind="textField" uuid="5a6b7c8d-9e0f-1a2b-3c4d-5e6f7a8b9c0d" x="180" y="116" width="140" height="18" forecolor="#FF8C00" fontSize="13.0" pattern="S/ #,##0.00" bold="true" hTextAlign="Right" vTextAlign="Middle">
            <expression><![CDATA[$V{promedio_saldo}]]></expression>
        </element>
    </summary>
</jasperReport>